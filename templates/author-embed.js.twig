(function() {
    const widgetId = 'author-widget-{{ widget.id }}';
    
    // Create container
    const container = document.createElement('div');
    container.id = widgetId;
    container.style.fontFamily = 'system-ui, -apple-system, sans-serif';
    container.style.maxWidth = '600px';
    container.style.margin = '40px auto';
    container.style.padding = '30px';
    container.style.backgroundColor = '{{ widget.backgroundColor|default("#ffffff") }}';
    container.style.borderRadius = '{{ widget.borderRadius|default(16) }}px';
    container.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)';
    container.style.textAlign = 'center';

    // Create styles
    const style = document.createElement('style');
    style.textContent = `
        #${widgetId} .bnnr_auth_photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 20px auto;
            border: 4px solid #f3f4f6;
            display: block;
            flex-shrink: 0;
        }
        #${widgetId} .bnnr_auth_name {
            font-size: 24px;
            font-weight: 700;
            color: {{ widget.nameColor|default('#111827') }};
            margin: 0 0 8px 0;
        }
        #${widgetId} .bnnr_auth_title {
            font-size: 16px;
            font-weight: 500;
            color: {{ widget.titleColor|default('#4f46e5') }};
            margin: 0 0 20px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        #${widgetId} .bnnr_auth_bio {
            font-size: 16px;
            line-height: 1.6;
            color: {{ widget.bioColor|default('#4b5563') }};
            margin: 0;
        }

        /* Side-by-side Layout */
        #${widgetId}.bnnr_layout_side {
            display: flex;
            align-items: flex-start;
            text-align: left;
            gap: 30px;
        }
        #${widgetId}.bnnr_layout_side .bnnr_auth_photo {
            margin: 0;
            width: 150px;
            height: 150px;
        }
        #${widgetId}.bnnr_layout_side .bnnr_auth_content {
            flex: 1;
        }
        
        @media (max-width: 600px) {
            #${widgetId}.bnnr_layout_side {
                flex-direction: column;
                text-align: center;
            }
            #${widgetId}.bnnr_layout_side .bnnr_auth_photo {
                margin: 0 auto 20px auto;
            }
        }
    `;
    document.head.appendChild(style);

    // Content
    let contentHtml = '';
    const layout = '{{ widget.layout }}';
    
    if (layout === 'side-by-side') {
        container.classList.add('bnnr_layout_side');
        
        {% if widget.authorPhotoUrl %}
        contentHtml += `<img src="{{ widget.authorPhotoUrl }}" alt="{{ widget.authorName|e('html_attr') }}" class="bnnr_auth_photo">`;
        {% endif %}
        
        contentHtml += '<div class="bnnr_auth_content">';
        {% if widget.authorName %}
        contentHtml += `<h3 class="bnnr_auth_name">{{ widget.authorName|e('html') }}</h3>`;
        {% endif %}
        
        {% if widget.authorTitle %}
        contentHtml += `<div class="bnnr_auth_title">{{ widget.authorTitle|e('html') }}</div>`;
        {% endif %}
        
        {% if widget.authorBio %}
        contentHtml += `<p class="bnnr_auth_bio">{{ widget.authorBio|nl2br|e('js') }}</p>`;
        {% endif %}
        contentHtml += '</div>';
        
    } else {
        // Centered (Default)
        {% if widget.authorPhotoUrl %}
        contentHtml += `<img src="{{ widget.authorPhotoUrl }}" alt="{{ widget.authorName|e('html_attr') }}" class="bnnr_auth_photo">`;
        {% endif %}
        
        {% if widget.authorName %}
        contentHtml += `<h3 class="bnnr_auth_name">{{ widget.authorName|e('html') }}</h3>`;
        {% endif %}
        
        {% if widget.authorTitle %}
        contentHtml += `<div class="bnnr_auth_title">{{ widget.authorTitle|e('html') }}</div>`;
        {% endif %}
        
        {% if widget.authorBio %}
        contentHtml += `<p class="bnnr_auth_bio">{{ widget.authorBio|nl2br|e('js') }}</p>`;
        {% endif %}
    }

    container.innerHTML = contentHtml;

    // JSON-LD Structured Data
    const jsonLd = {
        "@context": "https://schema.org",
        "@type": "Person",
        "name": "{{ widget.authorName|e('js') }}",
        "jobTitle": "{{ widget.authorTitle|e('js') }}",
        "description": "{{ widget.authorBio|e('js') }}",
        "image": "{{ widget.authorPhotoUrl|e('js') }}"
    };

    const script = document.createElement('script');
    script.type = 'application/ld+json';
    script.text = JSON.stringify(jsonLd);
    document.head.appendChild(script);

    // Find script tag to insert after
    const scripts = document.getElementsByTagName('script');
    const currentScript = scripts[scripts.length - 1];
    currentScript.parentNode.insertBefore(container, currentScript.nextSibling);
})();
