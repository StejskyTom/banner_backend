(function() {
    'use strict';

    const products = {{ products|raw }};
    const feedId = '{{ feedId }}';
    const feedName = "{{ feedName }}";
    const layout = "{{ layout|default('carousel') }}";
    const options = {{ layoutOptions|json_encode|raw }} || {};

    const currentScript = document.currentScript ||
        (function() {
            const scripts = document.getElementsByTagName('script');
            return scripts[scripts.length - 1];
        })();

    const widgetContainer = document.createElement('div');
    widgetContainer.id = 'heureka-widget-' + feedId + '-' + Date.now();
    widgetContainer.className = 'bnnr_prod_widget bnnr_layout_' + layout;
    currentScript.parentNode.insertBefore(widgetContainer, currentScript);

    const hexToRgba = (hex, alpha) => {
        if (!hex) return 'rgba(0,0,0,' + alpha + ')';
        hex = hex.replace('#', '');
        if (hex.length === 3) hex = hex.split('').map(c => c + c).join('');
        const r = parseInt(hex.substring(0, 2), 16);
        const g = parseInt(hex.substring(2, 4), 16);
        const b = parseInt(hex.substring(4, 6), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    };

    const formatPrice = (price, format) => {
        if (!price) return '';
        let numPrice = parseFloat(price.toString().replace(/\s/g, '').replace(',', '.'));
        if (isNaN(numPrice)) return price;

        if (format === 'no_decimals') {
            return Math.round(numPrice).toLocaleString('cs-CZ').replace(/\s/g, '&nbsp;');
        }

        const formatted = numPrice.toLocaleString('cs-CZ', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        if (format === 'dot') {
            return formatted.replace(',', '.').replace(/\s/g, '&nbsp;');
        }

        return formatted.replace(/\s/g, '&nbsp;');
    };

    // Shadow Logic
    const shadowEnabled = options.cardShadowEnabled !== false; // Default true
    const shadowColor = options.cardShadowColor || '#000000';
    const shadowBlur = options.cardShadowBlur !== undefined ? options.cardShadowBlur : 10;
    const shadowOpacity = options.cardShadowOpacity !== undefined ? options.cardShadowOpacity : 10; // 0-100 (reversed logic in UI handled in frontend)
    // Frontend saves "inverted" logic? No, in frontend "0% transparency = 100% opacity".
    // "100% transparency = 0% opacity".
    // In UI: "Průhlednost stínu (X%)". Value passed to backend is `cardShadowOpacity`.
    // Wait, in frontend I did `value={100 - cardShadowOpacity}` for display/slider, but state is `cardShadowOpacity`.
    // Default state 10. `100 - 10 = 90%` displayed? Or `10%`?
    // Let's check frontend again...
    // In frontend defaults: `const [cardShadowOpacity, setCardShadowOpacity] = useState(10);`
    // UI Label: `Průhlednost stínu ({100 - cardShadowOpacity}%)`
    // Slider Value: `100 - cardShadowOpacity`
    // onChange: `setCardShadowOpacity(100 - val)`
    // So if I set slider to 0 (Full Opacity), val=0, `setCardShadowOpacity(100)`. Backend gets 100.
    // If I set slider to 100 (Invisible), val=100, `setCardShadowOpacity(0)`. Backend gets 0.
    // So `cardShadowOpacity` IS the opacity/alpha value (0-100).
    // So `hexToRgba(shadowColor, shadowOpacity / 100)` is correct.

    // BUT wait, looking at my frontend code in Step 319:
    // `value={100 - cardShadowOpacity}`
    // `onChange={(e) => setCardShadowOpacity(100 - parseInt(e.target.value))}`
    // If I want 0% transparency (full visible), slider = 0. `setCardShadowOpacity(100 - 0) = 100`.
    // If I want 100% transparency (invisible), slider = 100. `setCardShadowOpacity(100 - 100) = 0`.
    // So stored value is Opacity (0-100).

    const shadowStyle = shadowEnabled
        ? `0 4px ${shadowBlur}px ${hexToRgba(shadowColor, shadowOpacity / 100)}`
        : 'none';

    const hoverShadowStyle = shadowEnabled
        ? `0 10px ${Math.max(15, shadowBlur + 5)}px ${hexToRgba(shadowColor, Math.max(0, (shadowOpacity / 100) - 0.05))}`
        : 'none';


    const styles = `
        .bnnr_prod_widget {
            width: 100% !important;
            margin: 32px auto !important;
            font-family: system-ui, -apple-system, sans-serif !important;
            box-sizing: border-box !important;
        }

        .bnnr_prod_widget * {
            box-sizing: border-box !important;
        }

        .bnnr_prod_widget h1,
        .bnnr_prod_widget h2,
        .bnnr_prod_widget h3,
        .bnnr_prod_widget p.bnnr_widget_title {
            text-align: ${options.widgetTitleAlign || 'center'} !important;
            font-size: ${options.widgetTitleSize || '24px'} !important;
            margin: 0 0 ${options.widgetTitleMarginBottom !== undefined ? options.widgetTitleMarginBottom : 32}px !important;
            font-family: ${options.widgetTitleFont || 'inherit'} !important;
            font-weight: ${options.widgetTitleBold ? '700' : '400'} !important;
            font-style: ${options.widgetTitleItalic ? 'italic' : 'normal'} !important;
            color: ${options.widgetTitleColor || '#111827'} !important;
            letter-spacing: -0.025em !important;
            line-height: 1.2 !important;
        }

        .bnnr_prod_card {
            background: ${options.cardBackgroundColor || '#ffffff'} !important;
            border-radius: ${options.cardBorderRadius !== undefined ? options.cardBorderRadius : 16}px !important;
            padding: ${options.cardPaddingY !== undefined ? options.cardPaddingY : 20}px ${options.cardPaddingX !== undefined ? options.cardPaddingX : 20}px !important;
            box-shadow: ${shadowStyle} !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            text-align: center !important;
            display: flex !important;
            flex-direction: column !important;
            justify-content: space-between !important;
            height: auto !important;
            box-sizing: border-box !important;
            border: ${options.cardBorderEnabled ? (options.cardBorderWidth || 1) + 'px solid ' + (options.cardBorderColor || '#e5e7eb') : 'none'} !important;
            text-decoration: none !important;
        }

        .bnnr_prod_card:hover {
            transform: translateY(-4px) !important;
            box-shadow: ${hoverShadowStyle} !important;
        }

        .bnnr_img_wrapper {
            width: 100% !important;
            height: ${options.imageHeight || 192}px !important;
            margin-bottom: ${options.imageMarginBottom !== undefined ? options.imageMarginBottom : 16}px !important;
            padding: ${options.imagePadding || 0}px !important;
            border-radius: ${options.imageBorderRadius || 0}px !important;
            overflow: hidden !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            box-sizing: border-box !important;
            background: #ffffff !important;
            border: none !important;
        }

        .bnnr_img_wrapper img {
            width: 100% !important;
            height: 100% !important;
            object-fit: ${options.imageObjectFit || 'contain'} !important;
            transition: transform 0.3s ease !important;
            border: none !important;
            max-width: 100% !important;
            display: block !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .bnnr_prod_card:hover .bnnr_img_wrapper img {
            transform: scale(1.05) !important;
        }

        .bnnr_prod_title {
            font-size: ${options.productNameSize || '15px'} !important;
            font-weight: ${options.productNameBold ? '700' : '400'} !important;
            font-style: ${options.productNameItalic ? 'italic' : 'normal'} !important;
            font-family: ${options.productNameFont || 'inherit'} !important;
            color: ${options.productNameColor || '#374151'} !important;
            margin-top: ${options.productNameMarginTop || 0}px !important;
            margin-bottom: ${options.productNameMarginBottom !== undefined ? options.productNameMarginBottom : 12}px !important;
            min-height: ${options.productNameFull ? 'auto' : '44px'} !important;
            display: -webkit-box !important;
            -webkit-line-clamp: ${options.productNameFull ? 'unset' : '2'} !important;
            -webkit-box-orient: vertical !important;
            overflow: hidden !important;
            line-height: 1.5 !important;
            flex-grow: 1 !important;
            text-decoration: none !important;
            text-decoration: none !important;
        }

        .bnnr_prod_desc {
            font-size: ${options.descriptionSize || '14px'} !important;
            font-weight: ${options.descriptionBold ? '700' : '400'} !important;
            font-style: ${options.descriptionItalic ? 'italic' : 'normal'} !important;
            font-family: ${options.descriptionFont || 'inherit'} !important;
            color: ${options.descriptionColor || '#4b5563'} !important;
            text-align: ${options.descriptionAlign || 'center'} !important;
            margin-top: ${options.descriptionMarginTop || 0}px !important;
            margin-bottom: ${options.descriptionMarginBottom !== undefined ? options.descriptionMarginBottom : 12}px !important;
            line-height: 1.625 !important;
            overflow: hidden !important;
            display: -webkit-box !important;
            -webkit-line-clamp: 4 !important;
            -webkit-box-orient: vertical !important;
        }

        .bnnr_prod_price {
            font-size: ${options.priceSize || '22px'} !important;
            font-weight: ${options.priceBold ? '800' : '400'} !important;
            font-style: ${options.priceItalic ? 'italic' : 'normal'} !important;
            font-family: ${options.priceFont || 'inherit'} !important;
            color: ${options.priceColor || '#059669'} !important;
            margin-top: ${options.priceMarginTop || 0}px !important;
            margin-bottom: ${options.priceMarginBottom !== undefined ? options.priceMarginBottom : 16}px !important;
            letter-spacing: -0.025em !important;
            line-height: 1.2 !important;
        }

        .bnnr_buy_btn {
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 12px 24px !important;
            background: ${options.buttonColor || '#2563eb'} !important;
            color: ${options.buttonTextColor || 'white'} !important;
            font-size: ${options.buttonFontSize || '14px'} !important;
            font-weight: ${options.buttonBold ? '600' : '400'} !important;
            font-style: ${options.buttonItalic ? 'italic' : 'normal'} !important;
            font-family: ${options.buttonFont || 'inherit'} !important;
            text-decoration: none !important;
            border-radius: ${options.buttonBorderRadius !== undefined ? options.buttonBorderRadius : 12}px !important;
            transition: all 0.2s !important;
            margin-top: ${options.buttonMarginTop || 0}px !important;
            margin-bottom: ${options.buttonMarginBottom || 0}px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            border: none !important;
            cursor: pointer !important;
        }

        .bnnr_buy_btn:hover {
            filter: brightness(90%) !important;
            transform: translateY(-1px) !important;
        }

        /* Carousel Styles */
        .bnnr_layout_carousel .bnnr_car_wrapper {
            overflow: visible !important;
            position: relative !important;
            width: 100% !important;
            padding: 0 10px !important;
            box-sizing: border-box !important;
        }
        .bnnr_layout_carousel .bnnr_car_track {
            display: flex !important;
            gap: 24px !important;
            overflow-x: auto !important;
            scroll-behavior: smooth !important;
            scrollbar-width: none !important;
            -ms-overflow-style: none !important;
            padding: 10px 0 20px 0 !important;
            width: 100% !important;
            align-items: stretch !important;
        }
        .bnnr_layout_carousel .bnnr_car_track::-webkit-scrollbar {
            display: none !important;
        }
        .bnnr_layout_carousel .bnnr_prod_card {
            min-width: calc((100% - (${options.gridColumns || 4} - 1) * 24px) / ${options.gridColumns || 4}) !important;
            max-width: calc((100% - (${options.gridColumns || 4} - 1) * 24px) / ${options.gridColumns || 4}) !important;
            flex-shrink: 0 !important;
        }

        .bnnr_car_arrow {
            position: absolute !important;
            top: 50% !important;
            transform: translateY(-50%) !important;
            background: ${options.carouselArrowsBackground || 'white'} !important;
            border: none;
            border-radius: ${options.carouselArrowsBorderRadius !== undefined ? options.carouselArrowsBorderRadius : 50}% !important;
            width: 40px !important;
            height: 40px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            cursor: pointer !important;
            z-index: 10 !important;
            color: ${options.carouselArrowsColor || '#374151'} !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
            transition: all 0.2s !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .bnnr_car_arrow:hover {
            filter: brightness(95%) !important;
        }
        .bnnr_car_arrow_left { left: -20px !important; }
        .bnnr_car_arrow_right { right: -20px !important; }

        @media (max-width: 768px) {
            .bnnr_car_arrow_left { left: 0 !important; }
            .bnnr_car_arrow_right { right: 0 !important; }
            .bnnr_layout_carousel .bnnr_prod_card {
                min-width: calc((100% - (${options.mobileGridColumns || 1} - 1) * 24px) / ${options.mobileGridColumns || 1}) !important;
                max-width: calc((100% - (${options.mobileGridColumns || 1} - 1) * 24px) / ${options.mobileGridColumns || 1}) !important;
            }
        }

        .bnnr_car_dots {
            display: flex !important;
            justify-content: center !important;
            gap: 8px !important;
            margin-top: ${options.carouselDotsMarginTop !== undefined ? options.carouselDotsMarginTop : 16}px !important;
        }

        .bnnr_car_dot {
            width: 8px !important;
            height: 8px !important;
            border-radius: 50% !important;
            background: ${options.carouselDotsColor || '#d1d5db'} !important;
            cursor: pointer !important;
            border: none !important;
            padding: 0 !important;
            transition: all 0.2s !important;
        }

        .bnnr_car_dot.active {
            background: ${options.carouselDotsActiveColor || options.buttonColor || '#2563eb'} !important;
            transform: scale(1.2) !important;
        }


        /* Grid Styles */
        .bnnr_layout_grid .bnnr_grid_wrapper {
            display: grid !important;
            grid-template-columns: repeat(${options.gridColumns || 4}, 1fr) !important;
            gap: 24px !important;
            width: 100% !important;
        }

        /* List Styles */
        .bnnr_layout_list .bnnr_list_wrapper {
            display: flex !important;
            flex-direction: column !important;
            gap: 16px !important;
            width: 100% !important;
        }
        .bnnr_layout_list .bnnr_prod_card {
            flex-direction: row !important;
            align-items: center !important;
            text-align: left !important;
            height: auto !important;
            max-width: 100% !important;
            padding: 16px 24px !important;
        }
        .bnnr_layout_list .bnnr_img_wrapper {
            width: 80px !important;
            height: 80px !important;
            margin-bottom: 0 !important;
            margin-right: 20px !important;
            flex-shrink: 0 !important;
        }
        .bnnr_layout_list .bnnr_prod_title {
            margin-bottom: 0 !important;
            margin-right: 24px !important;
            min-height: auto !important;
            -webkit-line-clamp: 2 !important;
            font-size: 16px !important;
        }
        .bnnr_layout_list .bnnr_prod_price {
            margin-bottom: 0 !important;
            margin-right: 24px !important;
            white-space: nowrap !important;
            margin-left: auto !important;
            font-size: 18px !important;
        }
        .bnnr_layout_list .bnnr_buy_btn {
            margin-top: 0 !important;
            width: auto !important;
            min-width: 140px !important;
            flex-shrink: 0 !important;
        }

        @media (max-width: 768px) {
            .bnnr_layout_carousel .bnnr_prod_card {
                min-width: 180px !important;
                max-width: 180px !important;
            }
            .bnnr_layout_carousel .bnnr_img_wrapper {
                height: 120px !important;
            }
            .bnnr_layout_grid .bnnr_grid_wrapper {
                grid-template-columns: repeat(${options.mobileGridColumns || 1}, 1fr) !important;
            }
            .bnnr_layout_list .bnnr_prod_card {
                flex-wrap: wrap !important;
                padding: 16px !important;
            }
            .bnnr_layout_list .bnnr_img_wrapper {
                width: 60px !important;
                height: 60px !important;
                margin-right: 16px !important;
            }
            .bnnr_layout_list .bnnr_prod_title {
                font-size: 14px !important;
                margin-right: 0 !important;
                width: calc(100% - 76px) !important;
                margin-bottom: 12px !important;
            }
            .bnnr_layout_list .bnnr_prod_price {
                margin-left: 0 !important;
                margin-right: auto !important;
                font-size: 18px !important;
            }
            .bnnr_layout_list .bnnr_buy_btn {
                width: auto !important;
                min-width: 120px !important;
                margin-left: 16px !important;
            }
        }
    `;

    if (!document.getElementById('heureka-widget-styles')) {
        const styleSheet = document.createElement('style');
        styleSheet.id = 'heureka-widget-styles';
        styleSheet.textContent = styles;
        document.head.appendChild(styleSheet);
    }

    function renderWidget() {
        if (!products || products.length === 0) {
            widgetContainer.innerHTML = '<p style="text-align: center; color: #666;">Žádné produkty k zobrazení</p>';
            return;
        }

        let contentHTML = '';

        if (layout === 'carousel') {
            const trackHTML = products.map(product => renderCard(product)).join('');

            // Arrows
            const arrows = options.carouselArrows !== false;
            const leftArrow = arrows ? `
                <button class="bnnr_car_arrow bnnr_car_arrow_left" aria-label="Predchozi">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" style="width: 20px; height: 20px;">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                    </svg>
                </button>
            ` : '';
            const rightArrow = arrows ? `
                <button class="bnnr_car_arrow bnnr_car_arrow_right" aria-label="Dalsi">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" style="width: 20px; height: 20px;">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                    </svg>
                </button>
            ` : '';

            // Dots
            const dotsEnabled = options.carouselDots !== false;
            let dotsHTML = '';
            if (dotsEnabled) {
                dotsHTML = '<div class="bnnr_car_dots"></div>';
            }

            contentHTML = `
                <div class="bnnr_car_wrapper">
                    ${leftArrow}
                    <div class="bnnr_car_track">
                        ${trackHTML}
                    </div>
                    ${rightArrow}
                    ${dotsHTML}
                </div>
            `;
        } else if (layout === 'grid') {
            const gridHTML = products.map(product => renderCard(product)).join('');
            contentHTML = `
                <div class="bnnr_grid_wrapper">
                    ${gridHTML}
                </div>
            `;
        } else if (layout === 'list') {
            const listHTML = products.map(product => renderCard(product)).join('');
            contentHTML = `
                <div class="bnnr_list_wrapper">
                    ${listHTML}
                </div>
            `;
        }

        const validTags = ['h1', 'h2', 'h3', 'p'];
        const titleTag = validTags.includes(options.widgetTitleTag) ? options.widgetTitleTag : 'h2';
        const titleClass = titleTag === 'p' ? ' class="bnnr_widget_title"' : '';

        widgetContainer.innerHTML = `
            ${options.widgetTitle ? '<' + titleTag + titleClass + '>' + options.widgetTitle + '</' + titleTag + '>' : ''}
            ${contentHTML}
        `;

        if (layout === 'carousel') {
            const wrapper = widgetContainer.querySelector('.bnnr_car_wrapper');
            if (wrapper) {
                const track = wrapper.querySelector('.bnnr_car_track');
                const leftBtn = wrapper.querySelector('.bnnr_car_arrow_left');
                const rightBtn = wrapper.querySelector('.bnnr_car_arrow_right');

                if (track) {
                    const dotsContainer = wrapper.querySelector('.bnnr_car_dots');

                    const updateActiveDot = () => {
                         if (!dotsContainer) return;
                         const dots = dotsContainer.querySelectorAll('.bnnr_car_dot');
                         if (dots.length === 0) return;

                         const scrollLeft = track.scrollLeft;
                         const item = track.firstElementChild;
                         const itemWidth = item ? (item.offsetWidth + 24) : 0;
                         if (itemWidth === 0) return;

                         let index = Math.round(scrollLeft / itemWidth);

                         // Clamp index to max dots
                         index = Math.min(index, dots.length - 1);

                         dots.forEach((dot, i) => {
                             if (i === index) dot.classList.add('active');
                             else dot.classList.remove('active');
                         });
                    };

                    const updateDots = () => {
                        if (!dotsContainer) return;
                        const isMobile = window.innerWidth <= 768;
                        const cols = isMobile ? (options.mobileGridColumns || 1) : (options.gridColumns || 4);

                        // Calculate how many distinct start positions are valid
                        // If we have 10 items and show 4, we can scroll to indexes 0..6
                        // So we need 7 dots.
                        // total - visible + 1
                        const maxIndex = Math.max(0, products.length - cols);
                        const numDots = maxIndex + 1;

                        let html = '';
                        for (let i = 0; i < numDots; i++) {
                            html += '<button class="bnnr_car_dot" data-index="' + i + '" aria-label="Jit na polozku ' + (i + 1) + '"></button>';
                        }
                        dotsContainer.innerHTML = html;

                        // Rebind clicks
                        const dots = dotsContainer.querySelectorAll('.bnnr_car_dot');
                        dots.forEach(dot => {
                            dot.onclick = function() {
                                const index = parseInt(this.getAttribute('data-index'));
                                const item = track.firstElementChild;
                                const itemWidth = item ? (item.offsetWidth + 24) : 0;
                                if (itemWidth > 0) {
                                    track.scrollTo({ left: index * itemWidth, behavior: 'smooth' });
                                }
                            };
                        });

                        updateActiveDot();
                    };

                    track.addEventListener('scroll', updateActiveDot);
                    window.addEventListener('resize', updateDots);

                    // Initial setup
                    updateDots();



                    // Arrow logic
                    if (leftBtn && rightBtn) {
                        leftBtn.onclick = function() {
                            const item = track.firstElementChild;
                            const scrollAmount = item ? (item.offsetWidth + 24) : 300;
                            track.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
                        };
                        rightBtn.onclick = function() {
                            const item = track.firstElementChild;
                            const scrollAmount = item ? (item.offsetWidth + 24) : 300;
                            track.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                        };
                    }
                }
            }
        }
    }

    function truncateText(text, length) {
        if (!text) return '';
        if (text.length <= length) return text;
        return text.substring(0, length) + '...';
    }

    function renderCard(product) {
        const descEnabled = options.descriptionEnabled;
        const descTag = options.descriptionTag || 'p';
        const truncateLen = options.descriptionTruncateLength || 100;
        const rawDesc = product.description || '';
        const finalDesc = truncateText(rawDesc, truncateLen);

        const descHTML = descEnabled ? '<' + descTag + ' class="bnnr_prod_desc">' + finalDesc + '</' + descTag + '>' : '';

        return `
            <a href="${product.url}" target="_blank" rel="noopener noreferrer" class="bnnr_prod_card">
                <div class="bnnr_img_wrapper">
                    <img src="${product.imgUrl || '/placeholder.png'}" alt="${product.productName}" loading="lazy">
                </div>
                <div class="bnnr_prod_title" title="${product.productName.replace(/"/g, '&quot;')}">${product.productName}</div>
                ${descHTML}
                <div class="bnnr_prod_price">${formatPrice(product.priceVat, options.priceFormat || 'comma')} Kč</div>
                <div class="bnnr_buy_btn">
                    ${options.buttonText || 'Koupit'}
                </div>
            </a>
        `;
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', renderWidget);
    } else {
        renderWidget();
    }

    // Track View
    (function() {
        try {
            fetch('{{ app.request.schemeAndHttpHost }}/api/widget/track', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    widgetId: feedId, 
                    widgetType: 'heureka' 
                }),
                keepalive: true,
                credentials: 'omit'
            }).catch(function() {});
        } catch (e) {}
    })();
})();
